- DONE #[[Gestión general]]
  :LOGBOOK:
  CLOCK: [2022-12-02 Fri 09:41:54]--[2022-12-02 Fri 10:14:48] =>  00:32:54
  CLOCK: [2022-12-02 Fri 12:12:08]--[2022-12-02 Fri 12:28:00] =>  00:15:52
  CLOCK: [2022-12-02 Fri 13:39:22]--[2022-12-02 Fri 13:39:25] =>  00:00:03
  CLOCK: [2022-12-02 Fri 14:42:08]--[2022-12-02 Fri 14:47:03] =>  00:04:55
  :END:
- DONE #Work/Freelancing/US Repartir todas las variables demográficas del IECA en los buildings
- #Work/Sunntics/Algorithm Despliegue **en caliente** de un nuevo **algoritmo**
  collapsed:: true
  - Cuando hay una nueva versión del algoritmo que es **caja negra** para [[libsunnsaasbackend]] y/o la [[SunnSaaS API]] podemos hacer un despliegue **en caliente** del mismo
  - Antes de proceder, documentar en [[Logseq]] el despliegue en caliente del algoritmo. Ir a [[GitRepo/sunntics-core-restricted/algorithm-ready-sunnsaas]] y ver los metadatos del algoritmo actualmente desplegado en **versions.json** y documentarlo en [[Logseq]], para obtener finalmente algo similar a lo descrito a continuación
    collapsed:: true
    - Última versión desplegada
      collapsed:: true
      - ```json
        {
          "gitBranch": "24_polar_dev_slope_inarow",
          "hashGitCommit": "4c932e7",
          "hashMeteoBinary": "ab628a26ed44efdd7d32d57c883fda86",
          "hashStfieldwBinary": "7c43940496ff1c51610c70b55adc30b2",
          "time": "2022-11-15 15:21:05"
        }
        ```
    - Nueva versión desplegada
      collapsed:: true
      - ```json
        {
          "gitBranch": "24_polar_dev_slope_inarow",
          "hashGitCommit": "e8be106",
          "hashMeteoBinary": "ab628a26ed44efdd7d32d57c883fda86",
          "hashStfieldwBinary": "173a30298d37c0ae55c688628e3de9bc",
          "time": "2022-12-02 09:36:11"
        }
        ```
  - Para ello, ir a **[[GitRepo/sunntics-core-restricted/monolithic-core-algorithms]]** y seguir los siguientes pasos (que también están en el README.md)
    collapsed:: true
    - Estudiar los nuevos commits, para ver si sólo están afectados **ficheros Fortran .for** o están afectados ficheros de configuración claves como el **InpF.txt** o el **InpFOptPar.txt**. Si esto sucede, todo se complica más puesto que **[[libsunnsaasbackend]]** se verá afectada y necesitará ser testeada con el nuevo algoritmo. En este caso, **NO SE PUEDE HACER UN HOT SWAP** (ver **Despliegue de cambios completo**).
    - Lanzar **docker/010-docker-run.sh** para obtener un entorno Fortran y hacer **cd fortran ; make all-prod** para crear los binarios y los metadatos de producción. Ver que corre. Los binarios van a **bin**.
    - Salir del **Docker** y ejecutar **000-curated_inputs/copy_assets_to_algorithm_ready_sunnsaas.sh** para copiar los binarios en **fortran/bin** al repositorio de control de versiones de algoritmo **[[GitRepo/sunntics-core-restricted/algorithm-ready-sunnsaas]]**
  - Ahora pasamos a **[[GitRepo/sunntics-core-restricted/algorithm-ready-sunnsaas]]**, que actúa como repositorio proxy de versiones del algoritmo que se han llegado a desplegar en [[SunnSaaS]]
    collapsed:: true
    - Documentar el despliegue en [[Logseq]] copiando el resultado de **versions.json** (ver al principio)
    - Recordemos que el **HOT SWAP** no se preocupa de cambios en los inputs (**InpF**, **InpFOptPar**, por ejemplo) que obligue a un **despliegue completo**
    - Ejecutar directamente **install_production** para instalar los binarios en **[[GitRepo/sunntics-generic-libraries/libsunnsaasbackend]]** y en **[[GitRepo/sunnsaas/sunnsaas_v1]]** (aunque no se vayan a testear ni desplegar)
  - Ya que estamos en un HOT SWAP, no hay que testear nada más. Pasamos directamente por tanto a **[[GitRepo/sunnsaas/sunnsaas_v1]]** para un despliegue directo
    collapsed:: true
    - Dado que no hay que hacer rebuild de nada, se pasa directamente a **030_swarms** para un despliegue directo a los remotos
    - Ejecutando **002-get_assets.sh** se actualizan (incluidos los binarios nuevos) los **assets** a mandar a los remotos. Esto no es necesario hacerlo ya que se ejecuta automáticamente con **rsync.sh**.
    - Por lo tanto, lo que resta es activar el contexto **mlkctxt** adecuado y hacer **rsync.sh**
    - Pasamos al remoto con **ssh.sh** y nos aseguramos que la versión correcta de los binarios ha subido a **assets**. Una vez en él, desplegamos los binarios subidos con **007**. Esto los hace disponibles para los trabajadores SunnSaaS en los volúmenes compartidos Docker, pudiéndose comprobar en el volumen **sunnsaas-fortran**.
- [#B] #Work/Sunntics/SunnSaaS El borrado de las AnalysisTasks de Analysis que ya están terminadas tarda horrores. Hay varios factores que se discuten aquí: [performance - Very slow DELETE in PostgreSQL, workaround? - Database Administrators Stack Exchange](https://dba.stackexchange.com/questions/37034/very-slow-delete-in-postgresql-workaround). Mirar.